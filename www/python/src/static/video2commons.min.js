var labels={},lang="en";labels.en={remove:" Remove",restart:" Restart",next:" Next",loading:"LOADING",confirm:"Confirm ",errorGeneric:"Something went terribly wrong. Please refresh this page or contact [[:commons:User:Zhuyifei1999]].",errorTooLarge:"File too large to upload directly! You may want to <a>request a server-side upload</a>.",addTask:"Add task",yourTasks:"Your tasks",createServerSide:"Create server-side upload ticket in one go (recommended)",requestServerSide:"<a>request a server-side upload</a>",taskDone:"Your task is done. You may find your upload at"},labels.es={remove:" Remover",restart:" Reiniciar",next:" Siguiente",loading:"CARGANDO",confirm:"Confirmar ",errorGeneric:"Algo terrible ha ocurrido. Por favor, actualiza la página o contacta a [[:commons:User:Zhuyifei1999]].",errorTooLarge:"El archivo es demasiado grande para subir directamente! Podrías hacer una <a>petición de subida en server-side upload</a>.",addTask:"Agregar tarea",yourTasks:"Tus tareas",createServerSide:"Crear un ticket para subidas en server-side (recomendado)",requestServerSide:"<a>petición de subida en server-side upload</a>",taskDone:"Tarea completada. Podrías encontrar tu subida en"};var loaderImage='<img alt="File:Ajax-loader.gif" src="//upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" data-file-width="32" data-file-height="32" height="32" width="32">',htmlContent={removebutton:'<button type="button" class="btn btn-danger btn-xs pull-right"><span class="glyphicon glyphicon-trash"></span>'+labels[lang].remove+"</button>",restartbutton:'<button type="button" class="btn btn-warning btn-xs pull-right"><span class="glyphicon glyphicon-repeat"></span>'+labels[lang].restart+"</button>",loading:"<center>"+loaderImage+"&nbsp;&nbsp;"+labels[lang].loading+"...</center>",errorGeneric:'<div class="alert alert-danger">'+labels[lang].errorGeneric+".</div>",yourTasks:'<div class="container" id="content"><h4>'+labels[lang].yourTasks+':</h4><table id="tasktable" class="table"><tbody></tbody></table></div>',addTask:'<input class="btn btn-primary btn-success btn-md" type="button" accesskey="n" value="'+labels[lang].addTask+'...">',requestServerSide:'<a class="btn btn-primary btn-success btn-md pull-right disabled" id="ssubtn">'+labels[lang].createServerSide+"</a>",progressbar:'<div class="progress"><div class="progress-bar" role="progressbar"></div></div>'};!function(a){"use strict";var e=window.video2commons={};e.init=function(){a("#content").html(htmlContent.loading),e.checkStatus()},e.checkStatus=function(){window.lastStatusCheck&&clearTimeout(window.lastStatusCheck);var t="api/status";a.get(t).done(function(t){a("#tasktable").length||e.setupTables(),e.populateResults(t),window.lastStatusCheck=setTimeout(e.checkStatus,t.hasrunning?5e3:6e4)}).fail(function(){a("#content").html(htmlContent.genericError)})},e.setupTables=function(){a("#content").html(htmlContent.yourTasks);var t=a(htmlContent.addTask);a("#content").append(t),t.click(function(){e.addTask()});var d=a(htmlContent.requestServerSide);a("#content").append(d.hide())},e.setProgressBar=function(a,e){var t=a.find(".progress-bar");0>e?(t.addClass("progress-bar-striped active").addClass("active").text(""),e=100):t.removeClass("progress-bar-striped active").text(e+"%"),t.attr({"aria-valuenow":e,"aria-valuemin":"0","aria-valuemax":"100",style:"width:"+e+"%"})},e.getTaskIDFromDOMID=function(a){var e=/^(?:task-)?(.+?)(?:-(?:title|statustext|progress|removebutton|restartbutton))?$/.exec(a);return e[1]},e.populateResults=function(t){var d=a("#tasktable > tbody");a("#task-new").remove(),d.find("> tr").each(function(){var d=a(this),s=e.getTaskIDFromDOMID(d.attr("id"));t.ids.indexOf(s)<0&&d.remove()}),a.each(t.values,function(t,s){var i="task-"+s.id,o=a("#"+i),n=!1;o.length?o.attr("status")!==s.status&&(o.html(""),n=!0):(o=a("<tr />"),o.attr({id:i,status:s.status}),d.append(o),n=!0);var r;if(n){switch(s.status){case"progress":o.append(a("<td />").attr("id",i+"-title").attr("width","30%")).append(a("<td />").attr("id",i+"-status").attr("width","40%").append(a("<span />").attr("id",i+"-statustext"))).append(a("<td />").attr("id",i+"-progress").attr("width","30%"));var l=o.find("#"+i+"-progress").html(htmlContent.progressbar);e.setProgressBar(l,-1),o.removeClass("success danger");break;case"done":r=e.removebutton(this,i),e.appendButtoms([r],o,["danger","success"],i);break;case"fail":r=e.removebutton(this,i);var c=a(htmlContent.restartbuttom).attr("id",i+"-restartbutton").hide();e.appendButtoms([r,c],o,["success","danger"],i);break;case"needssu":r=e.removebutton(this,i);var u=a(labels[lang].requestServerSide).attr("href",s.url);e.appendButtoms([u,r],o,["success","danger"],i)}o.attr("status",s.status)}o.find("#"+i+"-title").text(s.title),"done"===s.status?o.find("#"+i+"-statustext").html(labels[lang].taskDone+" <a></a>.").find("a").attr("href",s.url).text(s.text):"needssu"===s.status?o.find("#"+i+"-statustext").html(labels[lang].errorTooLarge).find("a").attr("href",s.url):"fail"===s.status?(o.find("#"+i+"-statustext").text(s.text),s.restartable?o.find("#"+i+"-restartbutton").show().off().click(function(){a(this).addClass("disabled"),e.restartTask(e.getTaskIDFromDOMID(a(this).attr("id")))}):o.find("#"+i+"-restartbutton").off().hide()):o.find("#"+i+"-statustext").text(s.text),"progress"===s.status&&e.setProgressBar(o.find("#"+i+"-progress"),s.progress)}),t.ssulink?a("#ssubtn").removeClass("disabled").show().attr("href",t.ssulink):a("#ssubtn").addClass("disabled").hide()},e.addTask=function(){window.addTaskDialog?e.openTaskModal():a.get("static/html/addTask.min.html").success(function(t){window.addTaskDialog=a("<div>").html(t),window.addTaskDialog.addClass("modal fade").attr({id:"addTaskDialog",role:"dialog"}),a("body").append(window.addTaskDialog),window.addTaskDialog.find(".modal-body").keypress(function(e){13!==(e.which||e.keyCode)||a(":focus").is("textarea")||(window.addTaskDialog.find(".modal-footer #btn-next").click(),e.preventDefault())}),e.openTaskModal()})},e.newTask=function(){var t="api/task/new";a.post(t).done(function(a){window.newTaskTempID=a.id,e.setupAddTaskDialog(a)}).fail(function(){window.addTaskDialog.html(htmlContent.errorGeneric)})},e.setupAddTaskDialog=function(t){switch(window.addTaskDialog.find("#dialog-spinner").hide(),"error"!==t.step&&(window.addTaskStep=t.step),t.step){case"error":window.addTaskDialog.find(".modal-body #dialog-errorbox").length||window.addTaskDialog.find(".modal-body").append(a('<div class="alert alert-danger" id="dialog-errorbox"></div>')),window.addTaskDialog.find(".modal-body #dialog-errorbox").text("Error: "+t.error).show();break;case"source":a.get("static/html/sourceForm.min.html").success(function(a){window.addTaskDialog.find(".modal-body").html(a),window.addTaskDialog.find("#url").val(t.url).focus(),window.addTaskDialog.find("#video").prop("checked",t.video),window.addTaskDialog.find("#audio").prop("checked",t.audio),window.addTaskDialog.find("#subtitles").prop("checked",t.subtitles)});break;case"target":a.get("static/html/targetForm.min.html").success(function(e){window.addTaskDialog.find(".modal-body").html(e),window.addTaskDialog.find("#filename").val(t.filename).focus(),a.each(t.formats,function(e,t){window.addTaskDialog.find("#format").append(a("<option></option>").text(t))}),window.addTaskDialog.find("#format").val(t.format),window.addTaskDialog.find("#filedesc").val(t.filedesc)});break;case"confirm":a.get("static/html/confirmForm.min.html").success(function(a){window.addTaskDialog.find(".modal-body").html(a),e.setText(["url","extractor","keep","filename","format"],t),window.addTaskDialog.find("#filedesc").val(t.filedesc),window.addTaskDialog.find("#btn-next").focus()})}switch(window.addTaskStep){case"source":window.addTaskDialog.find("#btn-prev").addClass("disabled").off(),window.addTaskDialog.find("#btn-next").removeClass("disabled").html(labels[lang].next+' <span class="glyphicon glyphicon-chevron-right"></span>').off(),window.addTaskDialog.find("#btn-next").click(function(){e.disablePrevNext(),window.addTaskDialog.find("#dialog-spinner").show();var a={id:window.newTaskTempID,action:"next",step:window.addTaskStep,url:window.addTaskDialog.find("#url").val(),video:window.addTaskDialog.find("#video").is(":checked"),audio:window.addTaskDialog.find("#audio").is(":checked"),subtitles:window.addTaskDialog.find("#subtitles").is(":checked")};e.submitTask(a)});break;case"target":window.addTaskDialog.find("#btn-prev").removeClass("disabled").off(),window.addTaskDialog.find("#btn-next").removeClass("disabled").html(labels[lang].next+'t <span class="glyphicon glyphicon-chevron-right"></span>').off(),e.addTargetDialog("prev"),e.addTargetDialog("next");break;case"confirm":window.addTaskDialog.find("#btn-prev").removeClass("disabled").off(),window.addTaskDialog.find("#btn-next").removeClass("disabled").html(labels[lang].confirm+' <span class="glyphicon glyphicon-ok"></span>').off(),window.addTaskDialog.find("#btn-prev").click(function(){e.disablePrevNext(),window.addTaskDialog.find("#dialog-spinner").show();var a={id:window.newTaskTempID,action:"prev",step:window.addTaskStep};e.submitTask(a)}),window.addTaskDialog.find("#btn-next").click(function(){e.disablePrevNext(),window.addTaskDialog.modal("hide"),a("#tasktable > tbody").append('<tr id="task-new"><td colspan="3">'+loaderImage+"</td></tr>");var t={id:window.newTaskTempID,action:"next",step:window.addTaskStep};a.post("api/task/submit",t).done(function(a){a.error&&window.alert(a.error),e.checkStatus()})})}},e.removeTask=function(a){e.eventTask(a,"remove")},e.restartTask=function(a){e.eventTask(a,"restart")},e.eventTask=function(t,d){a.post("api/task/"+d,{id:t}).done(function(a){a.error&&window.alert(a.error),e.checkStatus()})},e.setText=function(a,e){for(var t=0;t<a.length;t++)window.addTaskDialog.find("#"+a[t]).text(e[a[t]])},e.getPostData=function(a){return{id:window.newTaskTempID,action:a,step:window.addTaskStep,filename:window.addTaskDialog.find("#filename").val(),format:window.addTaskDialog.find("#format").val(),filedesc:window.addTaskDialog.find("#filedesc").val()}},e.submitTask=function(t){a.post("api/task/submit",t).done(function(a){a.error&&window.alert(a.error),e.setupAddTaskDialog(a)})},e.addTargetDialog=function(a){window.addTaskDialog.find("#btn-"+a).click(function(){window.addTaskDialog.find(".modal-body #dialog-errorbox").hide(),window.addTaskDialog.find("#btn-prev").addClass("disabled").off(),window.addTaskDialog.find("#btn-next").addClass("disabled").off(),window.addTaskDialog.find("#dialog-spinner").show(),e.submitTask(e.getPostData(a))})},e.disablePrevNext=function(){window.addTaskDialog.find(".modal-body #dialog-errorbox").hide(),window.addTaskDialog.find("#btn-prev").addClass("disabled").off(),window.addTaskDialog.find("#btn-next").addClass("disabled").off()},e.removeButtomClick=function(t){return function(){a(t).addClass("disabled"),e.removeTask(e.getTaskIDFromDOMID(a(t).attr("id")))}},e.removebutton=function(t,d){return a(htmlContent.removebutton).attr("id",d+"-removebutton").off().click(e.removeButtomClick(t))},e.appendButtoms=function(e,t,d,s){t.append(a("<td />").attr("id",s+"-title").attr("width","30%"));for(var i=a("<td />").attr("id",s+"-status").attr("width","70%").attr("colspan","2").append(a("<span />").attr("id",s+"-statustext")).append(e[0]),o=1;o<e.length;o++)i.append(e[o]);t.append(i).removeClass(d[0]).addClass(d[1])},e.openTaskModal=function(){window.addTaskDialog.find("#dialog-spinner").hide(),window.addTaskDialog.find(".modal-body").html("<center>"+loaderImage+"</center>"),e.newTask(),window.addTaskDialog.modal(),window.addTaskDialog.on("shown.bs.modal",function(){window.addTaskDialog.find("#url").focus()})},a(document).ready(function(){e.init()})}(jQuery);
